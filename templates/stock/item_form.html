{% extends 'base.html' %}

{% load stock_extras %}

{% block content %}
<h2>{% if form.instance.pk %}{{ 'Edit Item'|translate:request.LANGUAGE_CODE }}{% else %}{{ 'New
    Item'|translate:request.LANGUAGE_CODE }}{% endif %}</h2>
<form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    {{ form.as_p }}
    <button type="submit" class="btn btn-block">{{ 'Save'|translate:request.LANGUAGE_CODE }}</button>
</form>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        // IDs generated by Django form
        var categorySelect = document.getElementById('id_category');
        var newCatInput = document.getElementById('id_new_category_name');

        if (categorySelect && newCatInput) {
            var container = newCatInput.closest('p');

            function toggleNewCat() {
                var selectedText = categorySelect.options[categorySelect.selectedIndex].text;
                // Check if text contains the code we set for new category: (NUE)
                if (selectedText.indexOf('(NUE)') !== -1) {
                    container.style.display = 'block';
                } else {
                    container.style.display = 'none';
                    newCatInput.value = ''; // Clear if hidden
                }
            }

            // Initial run
            toggleNewCat();

            // Change listener
            categorySelect.addEventListener('change', toggleNewCat);
        }
    });
</script>
{% endblock %}